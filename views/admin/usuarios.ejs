<%- include('../Parcial/header') %>

<div class="page-header">
  <h2>ðŸ‘¥ GestiÃ³n de Usuarios</h2>
</div>

<% if (usuarios.length === 0) { %>
  <p class="empty-message">No hay usuarios registrados.</p>
<% } else { %>
  <div class="tabla-contenedor">
    <table>
      <thead>
        <tr>
          <th>Usuario</th>
          <th>Rol</th>
          <th>Estado</th>
          <th>Fecha Registro</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <% usuarios.forEach(u => { %>
        <tr class="<%= !u.activo ? 'fila-inactivo' : '' %>">
          <td><strong>@<%= u.username %></strong></td>
          <td>
            <% if (u.role === 'administrador') { %>
              <span class="badge disponible">Administrador</span>
            <% } else { %>
              <span class="badge prestado">Usuario</span>
            <% } %>
          </td>
          <td>
            <% if (u.activo) { %>
              <span class="badge disponible">Activo</span>
            <% } else { %>
              <span class="badge agotado">Inactivo</span>
            <% } %>
          </td>
          <td><%= new Date(u.fechaRegistro).toLocaleDateString('es-MX') %></td>
          <td>
            <% if (u._id.toString() !== usuario.id.toString()) { %>
              <% if (u.role === 'usuario') { %>
                <form action="/admin/usuarios/<%= u._id %>/hacerAdmin" method="POST" style="display: inline;">
                  <button type="submit" class="btn-small btn-success" onclick="return confirm('Â¿Hacer administrador a <%= u.username %>?')">
                    Hacer Admin
                  </button>
                </form>
              <% } else { %>
                <form action="/admin/usuarios/<%= u._id %>/hacerUsuario" method="POST" style="display: inline;">
                  <button type="submit" class="btn-small btn-warning" onclick="return confirm('Â¿Quitar rol de admin a <%= u.username %>?')">
                    Quitar Admin
                  </button>
                </form>
              <% } %>
              
              <form action="/admin/usuarios/<%= u._id %>/toggleActivo" method="POST" style="display: inline;">
                <% if (u.activo) { %>
                  <button type="submit" class="btn-small btn-danger" onclick="return confirm('Â¿Desactivar a <%= u.username %>?')">
                    Desactivar
                  </button>
                <% } else { %>
                  <button type="submit" class="btn-small btn-success" onclick="return confirm('Â¿Activar a <%= u.username %>?')">
                    Activar
                  </button>
                <% } %>
              </form>
            <% } else { %>
              <span class="badge">Tu cuenta</span>
            <% } %>
          </td>
        </tr>
        <% }); %>
      </tbody>
    </table>
  </div>
<% } %>

<%- include('../Parcial/footer') %>